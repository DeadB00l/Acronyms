var jq$=jQuery.noConflict(),requestHeaders={ACCEPT:"application/json; odata=verbose"},acronymUrl=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/GetByTitle('Acronym')/items",requestUrl=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/GetByTitle('AcronymRequest')/items",selectStr="?$select=ID,Title,Definition,Category/Title",expandStr="&$expand=Category",acronyms=new Vue({el:"#AcronymMaster",data:{categories:[],results:[],requestObj:null,moreIncrement:50,isLoading:!1,isSaving:!1,errMsg:"",selectedCategory:0,selectedLetter:"",qry:"",letters:[]},methods:{MakeRequest:function(){this.requestObj={ID:0,Title:"",Definition:"",CategoryId:0}},GetItemTypeForListName:function(e){return"SP.Data."+e.replace(" ","_x0020_")+"ListItem"},BuildAlphabet:function(){for(var e="0,1,2,3,4,5,6,7,8,9,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z".split(","),t=0;t<e.length;t++){var s={value:e[t]};this.letters.push(s)}},LetterClick:function(e){this.selectedLetter=e,this.GetResults(this.moreIncrement)},MenuHandler:function(e){var t="#"+e;0===e.indexOf("Show")?(jQuery(t).parent().parent().find(".sectionItems").show(),jQuery(t).hide(),jQuery(t).removeClass("ShowArrow"),jQuery(t.replace("Show","Hide")).show()):(jQuery(t).parent().parent().find(".sectionItems").hide(),jQuery(t).hide(),jQuery(t.replace("Hide","Show")).show())},EnterCheck:function(e){13===e.keyCode&&this.GetResults(this.moreIncrement)},MoreClick:function(){var e=this.results.length+this.moreIncrement;this.GetResults(e)},CategoryClick:function(e,t){this.selectedCategory=t.ID,this.GetResults(this.moreIncrement)},ClearCategoryFilter:function(e){this.selectedCategory=0,this.GetResults(this.moreIncrement)},GetResults:function(e){this.isLoading=!0,this.results=[];var t="&$top="+e,s="?$select=Title,Definition,Category/Title",r="&$expand=Category",i="",n="&$orderby=Title asc";this.selectedCategory>0&&(i="(Category/ID eq "+this.selectedCategory+")"),this.qry.length>0&&(i.length>0&&(i+="and"),i+="((substringof('"+this.qry+"',Title))or(substringof('"+this.qry+"',Definition)))"),this.selectedLetter.length>0&&(i.length>0&&(i+="and"),i+="(Letter eq '"+this.selectedLetter+"')"),i.length>0&&(i="&$filter="+i);var o=acronymUrl+s+t+r+n+i,a=this;axios({method:"GET",url:o,headers:requestHeaders}).then(function(e){for(var t=e.data.d.results,s=0;s<t.length;s++){var r=t[s],i={ID:r.Id,Title:r.Title,Definition:r.Definition,CategoryId:r.CategoryId,CategoryTitle:r.Category.Title};a.results.push(i)}a.isLoading=!1})["catch"](function(e){console.log(e)})},GetCategories:function(){var e="$select=Title,ID",t="&$orderby=Title",s=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/getByTitle('Category')/items?"+e+t,r=this;axios({method:"GET",url:s,headers:requestHeaders}).then(function(e){for(var t=e.data.d.results,s=0;s<t.length;s++){var i=t[s],n={ID:i.ID,Title:i.Title};r.categories.push(n)}})["catch"](function(e){console.log(e)})},SearchClick:function(){this.GetResults(this.moreIncrement)},SaveRequestClick:function(){if(this.ValidateRequest()){var e=requestUrl,t={ACCEPT:"application/json;odata=verbose","X-RequestDigest":jq$("#__REQUESTDIGEST").val(),"Content-Type":"application/json; odata=verbose"},s=this;jQuery.ajax({method:"POST",url:e,headers:t,data:this.GetRequestDataStr(),success:function(e){s.requestObj=null,s.isSaving=!1},error:function(e){console.log(e)}})}},CancelRequestClick:function(){this.requestObj=null},GetRequestDataStr:function(e){var t={__metadata:{type:this.GetItemTypeForListName("AcronymRequest")},Title:this.requestObj.Title,Definition:this.requestObj.Definition,CategoryId:this.requestObj.CategoryId};return JSON.stringify(t)},ValidateRequest:function(){var e=!0;return this.errMsg="",null==this.requestObj?(e=!1,this.errMsg="Sorry, no acronym request found"):(null!=this.requestObj.Title&&0!==this.requestObj.Title.length||(e=!1,this.errMsg+="Please enter the acronym letters<br />"),null!=this.requestObj.Definition&&0!==this.requestObj.Definition.length||(e=!1,this.errMsg+="Please enter the acronym definition<br />"),0===this.requestObj.CategoryId&&(e=!1,this.errMsg+="Please select a acronym category<br />")),e}},created:function(){this.GetCategories(),this.BuildAlphabet(),this.GetResults(this.moreIncrement)}});